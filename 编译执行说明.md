# 锂离子电池RUL预测项目编译与执行指南

## 环境配置
```bash
# 创建虚拟环境（推荐）
python -m venv venv

# 激活环境
# Windows: 
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

## 完整执行流程

### 1. 数据预处理
```bash
python preprocess.py --config configs/config.yaml
```
- 输入：`data/final_dataset/` 下的CSV文件
- 输出：`data/processed/` 生成序列化数据(.npy)

### 2. 模型训练
```bash
python train.py --config configs/config.yaml
```
- 自动生成训练目录：`train_results/train_run_<时间戳>`
- 关键输出：
  - `checkpoints/best_model.pth`：最佳模型权重
  - `checkpoints/scaler.json`：数据标准化参数
  - `results/`：训练日志和曲线图

### 3. 模型预测
```bash
python predict.py \
  --config configs/config.yaml \
  --run_dir train_results/train_run_20251012_054025
```
- 在指定训练目录内生成`predictions/`子目录
- 输出内容：
  - `predictions_test.csv`：测试集预测结果
  - `test_scatter_pred_vs_true.png`：预测值-真实值散点图
  - `per_battery_traces/`：单电池预测轨迹可视化

## 配置系统详解
`configs/config.yaml` 包含三大模块：

### 1. 路径配置 (paths)
```yaml
data_dir: "data/final_dataset"   # 原始数据目录
processed_dir: "data/processed"  # 预处理数据目录
experiment_base_dir: "train_results"  # 训练结果根目录
```

### 2. 模型参数 (model_params)
```yaml
sae_dim: 32       # 稀疏自编码器隐藏层维度
d_model: 128      # Transformer模型维度
nhead: 4          # 注意力头数
quantiles: [0.1, 0.5, 0.9]  # 分位数回归设置
```

### 3. 训练参数 (train_params)
```yaml
batch_size: 128
epochs: 200
learning_rate: 0.0005
patience: 20      # 早停机制等待轮数
```

## 关键注意事项
1. 数据要求：
   - 训练/验证/测试集需命名为：`tabular_train.csv`, `tabular_val.csv`, `tabular_test.csv`
   - 每行数据代表单个电池循环的监测特征

2. GPU加速：
   ```bash
   # 在train.py开头添加以下代码启用GPU
   import torch
   device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
   ```

3. 多实验管理：
   ```bash
   # 比较不同训练结果
   python predict.py --run_dir train_results/train_run_20251012_054025
   python predict.py --run_dir train_results/train_run_20251015_093215